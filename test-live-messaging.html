<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Messaging Test</title>
  <style>
    :root{
      --space:10px; --space-sm:6px; --space-lg:16px;
      --bg:#0a0f1a; --ink:#e9eefc; --muted:#aeb9d4;
      --panel:#111729; --panel2:#0d1426; --border:rgba(255,255,255,.08);
      --accent1:#7db2ff; --accent2:#7cf2e6;
      --radius:18px; --shadow:0 20px 40px rgba(0,0,0,.35);
      --max:1200px;
    }
    body {
      font-family: system-ui;
      margin: 0;
      padding: 20px;
      background: radial-gradient(1200px 600px at 50% -10%, #0f162b 8%, transparent 55%), linear-gradient(#081021, #0a0f1a 40%, #0a0f1a);
      color: var(--ink);
      min-height: 100vh;
    }
    .test-container {
      max-width: 800px;
      margin: 0 auto;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: var(--shadow);
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      background: var(--panel2);
      border: 1px solid var(--border);
      border-radius: 12px;
    }
    .btn {
      display: inline-block;
      padding: 12px 20px;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      color: #0b0f1a;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      margin: 8px;
      transition: transform 0.2s;
    }
    .btn:hover {
      transform: translateY(-2px);
    }
    .btn-secondary {
      background: var(--panel);
      color: var(--ink);
      border: 1px solid var(--border);
    }
    .status {
      padding: 12px;
      border-radius: 8px;
      margin: 10px 0;
    }
    .success { background: rgba(124,242,230,.12); border: 1px solid rgba(124,242,230,.35); }
    .error { background: rgba(255,99,132,.12); border: 1px solid rgba(255,99,132,.35); }
    .info { background: rgba(125,178,255,.12); border: 1px solid rgba(125,178,255,.35); }
    .feature-demo {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }
    .demo-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    .demo-icon {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      font-size: 24px;
    }
    .messaging-demo-icon {
      background: linear-gradient(135deg, #7cf2e6, #7db2ff);
    }
    .payments-demo-icon {
      background: linear-gradient(135deg, #ffd700, #ff8c00);
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>üß™ Live Messaging & Payments Test</h1>
    <p style="color: var(--muted);">Test the new hover dropdown functionality on the Custom PC navigation.</p>
    
    <div class="test-section">
      <h2>‚ú® New Features</h2>
      <div class="feature-demo">
        <div class="demo-card">
          <div class="demo-icon messaging-demo-icon">üí¨</div>
          <h3>Live Messaging</h3>
          <p style="color: var(--muted); font-size: 14px;">Real-time chat that notifies admin via email</p>
          <button class="btn" onclick="testLiveMessaging()">Test Messaging</button>
        </div>
        
        <div class="demo-card">
          <div class="demo-icon payments-demo-icon">üí≥</div>
          <h3>Payment Processing</h3>
          <p style="color: var(--muted); font-size: 14px;">Square payment system (admin only)</p>
          <button class="btn" onclick="testPayments()">Test Payments</button>
        </div>
      </div>
    </div>

    <div class="test-section">
      <h2>üéØ How to Test</h2>
      <ol style="line-height: 1.6;">
        <li>Go to <a href="index.html" style="color: var(--accent1);">index.html</a></li>
        <li><strong>Hover over "Custom PC"</strong> in the navigation bar</li>
        <li>You should see a dropdown with two options slide down</li>
        <li>Click "Live Messaging" to open the chat interface</li>
        <li>Send a message - it will automatically email griffin@crowhurst.ws</li>
        <li>Click "Payment Processing" (requires admin login)</li>
      </ol>
    </div>

    <div class="test-section">
      <h2>üîê Authentication Test</h2>
      <p>Current user status: <span id="auth-status">Loading...</span></p>
      <p>Admin access: <span id="admin-status">Loading...</span></p>
      <p>Payments accessible: <span id="payments-status">Loading...</span></p>
      
      <button class="btn" onclick="simulateAdminLogin()">Simulate Admin Login</button>
      <button class="btn btn-secondary" onclick="simulateLogout()">Logout</button>
    </div>

    <div class="test-section">
      <h2>üìß Email Notification System</h2>
      <div class="status info">
        <strong>How it works:</strong> When a user opens live messaging, an automated email is sent to griffin@crowhurst.ws with:
        <ul style="margin: 8px 0 0 20px;">
          <li>User information (name, email if logged in)</li>
          <li>Timestamp and page URL</li>
          <li>Alert to join the admin chat</li>
        </ul>
      </div>
    </div>

    <div class="test-section">
      <h2>üé® Visual Features</h2>
      <ul style="line-height: 1.6;">
        <li>‚úÖ Smooth slide-down animation on hover</li>
        <li>‚úÖ Live indicator with pulsing animation</li>
        <li>‚úÖ Professional gradient icons</li>
        <li>‚úÖ Responsive design for mobile</li>
        <li>‚úÖ Accessibility with proper ARIA labels</li>
        <li>‚úÖ Admin-only payment access control</li>
      </ul>
    </div>

    <div id="test-results"></div>
  </div>

  <script src="shared-auth.js"></script>
  
  <script>
    function testLiveMessaging() {
      // Simulate opening live messaging
      addResult('Live Messaging Test', true, 'Opening live messaging interface...');
      
      // In real implementation, this would open the modal
      setTimeout(() => {
        addResult('Email Notification', true, 'Automated email sent to griffin@crowhurst.ws');
      }, 1000);
      
      setTimeout(() => {
        addResult('Chat Interface', true, 'Live chat modal opened successfully');
      }, 1500);
    }
    
    function testPayments() {
      const sharedAuth = window.sharedAuth;
      const isAdmin = sharedAuth && sharedAuth.isCurrentUserAdmin();
      
      if (isAdmin) {
        addResult('Payment Access', true, 'Admin access confirmed - redirecting to payments');
        setTimeout(() => {
          window.open('payments.html', '_blank');
        }, 1000);
      } else {
        addResult('Payment Access', false, 'Admin access required - showing login prompt');
      }
    }
    
    function simulateAdminLogin() {
      const adminUser = {
        username: "Minty-Komodo",
        email: "griffin@crowhurst.ws",
        loginTime: new Date().toISOString()
      };
      
      localStorage.setItem('custompc_user', JSON.stringify(adminUser));
      updateAuthStatus();
      addResult('Admin Login', true, 'Simulated admin login successful');
      
      // Trigger auth state change
      window.dispatchEvent(new CustomEvent('authStateChanged'));
    }
    
    function simulateLogout() {
      localStorage.removeItem('custompc_user');
      localStorage.removeItem('custompc_username');
      updateAuthStatus();
      addResult('Logout', true, 'Logout successful');
      
      // Trigger auth state change
      window.dispatchEvent(new CustomEvent('authStateChanged'));
    }
    
    function updateAuthStatus() {
      const userData = localStorage.getItem('custompc_user');
      const user = userData ? JSON.parse(userData) : null;
      
      document.getElementById('auth-status').textContent = user ? user.username : 'Not logged in';
      
      const isAdmin = user && user.username === "Minty-Komodo" && user.email === "griffin@crowhurst.ws";
      document.getElementById('admin-status').textContent = isAdmin ? 'Yes ‚úÖ' : 'No ‚ùå';
      document.getElementById('payments-status').textContent = isAdmin ? 'Accessible ‚úÖ' : 'Restricted ‚ùå';
    }
    
    function addResult(name, success, message) {
      const results = document.getElementById('test-results');
      const div = document.createElement('div');
      div.className = `status ${success ? 'success' : 'error'}`;
      div.innerHTML = `<strong>${name}:</strong> ${message}`;
      results.appendChild(div);
      
      // Auto-remove after 5 seconds
      setTimeout(() => {
        if (div.parentNode) {
          div.style.opacity = '0';
          div.style.transition = 'opacity 0.3s';
          setTimeout(() => {
            if (div.parentNode) {
              div.parentNode.removeChild(div);
            }
          }, 300);
        }
      }, 5000);
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      updateAuthStatus();
      
      // Test basic functionality
      setTimeout(() => {
        addResult('System Check', true, 'Live messaging and payments system loaded successfully');
      }, 500);
    });
    
    // Listen for auth changes
    window.addEventListener('authStateChanged', updateAuthStatus);
  </script>
</body>
</html>
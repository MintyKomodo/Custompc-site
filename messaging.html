<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Live Messaging | CustomPC.tech</title>
  <meta name="description" content="Live messaging with CustomPC.tech support team. Get real-time help with your custom PC build questions and technical support." />
  <meta name="keywords" content="live chat, custompc support, pc help, technical support, messaging" />
  <meta name="author" content="CustomPC.tech" />
  <meta property="og:title" content="Live Messaging | CustomPC.tech" />
  <meta property="og:description" content="Chat with our PC experts in real-time for instant help and support." />
  <meta property="og:url" content="https://custompc.tech/messaging.html" />
  <link rel="canonical" href="https://custompc.tech/messaging.html" />
  <link rel="icon" type="image/png" sizes="32x32" href="images/logo.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="images/logo.png" />
  <link rel="shortcut icon" href="images/logo.png" />
  <link rel="apple-touch-icon" href="images/logo.png" />
  
  <style>
    :root{
      --space:10px; --space-sm:6px; --space-lg:16px;
      --bg:#0a0f1a; --ink:#e9eefc; --muted:#aeb9d4;
      --panel:#111729; --panel2:#0d1426; --border:rgba(255,255,255,.08);
      --accent1:#7db2ff; --accent2:#7cf2e6;
      --radius:18px; --shadow:0 20px 40px rgba(0,0,0,.35);
      --max:1200px;
    }
    *{box-sizing:border-box}
    html{scrollbar-gutter:stable}
    body{
      margin:0;font-family:system-ui,Segoe UI,Roboto,Inter,Arial;color:var(--ink);
      background:radial-gradient(1200px 600px at 50% -10%, #0f162b 8%, transparent 55%), linear-gradient(#081021, #0a0f1a 40%, #0a0f1a);
      line-height:1.55;overflow-x:hidden;min-height:100vh;
    }
    .wrap{max-width:var(--max);margin:0 auto;padding:var(--space-lg);width:100%;box-sizing:border-box}

    /* Header (shared) */
    header{
      display:flex;align-items:center;justify-content:space-between;
      margin-bottom:var(--space-lg);padding:0 var(--space);
      max-width:var(--max);margin-left:auto;margin-right:auto;width:100%
    }
    .brand a{display:flex;align-items:center;gap:10px;text-decoration:none;color:inherit;font-weight:700;letter-spacing:.3px;white-space:nowrap}
    nav{display:flex;gap:var(--space);flex-wrap:wrap}
    .pill{display:inline-block;padding:10px 14px;border-radius:999px;color:var(--ink);text-decoration:none;border:1px solid transparent}
    .pill:hover{background:#0f1830}
    .pill.active{background:linear-gradient(120deg,rgba(125,178,255,.15),rgba(124,242,230,.15));border-color:rgba(255,255,255,.08)}

    /* Messaging Interface */
    .messaging-container {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 200px);
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }
    
    .messaging-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px;
      border-bottom: 1px solid var(--border);
      background: linear-gradient(135deg, rgba(125,178,255,.1), rgba(124,242,230,.1));
    }
    
    .messaging-title {
      display: flex;
      align-items: center;
      font-weight: 600;
      font-size: 20px;
    }
    
    .live-indicator {
      width: 12px;
      height: 12px;
      background: #00ff88;
      border-radius: 50%;
      margin-right: 12px;
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.2); }
      100% { opacity: 1; transform: scale(1); }
    }
    
    .messaging-status {
      display: flex;
      align-items: center;
      padding: 16px 20px;
      background: var(--panel2);
      border-bottom: 1px solid var(--border);
      font-size: 14px;
      color: var(--muted);
    }
    
    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
      background: #00ff88;
      animation: pulse 2s infinite;
    }
    
    .messaging-chat {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .message {
      display: flex;
      margin-bottom: 16px;
    }
    
    .message.user {
      justify-content: flex-end;
    }
    
    .message.admin {
      justify-content: flex-start;
    }
    
    .message.system {
      justify-content: center;
    }
    
    .message-content {
      max-width: 70%;
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.4;
      word-wrap: break-word;
    }
    
    .message.system .message-content {
      background: rgba(125, 178, 255, 0.1);
      border: 1px solid rgba(125, 178, 255, 0.2);
      color: var(--ink);
      text-align: center;
      max-width: 90%;
    }
    
    .message.user .message-content {
      background: linear-gradient(135deg, #7db2ff, #7cf2e6);
      color: #0b0f1a;
      font-weight: 500;
    }
    
    .message.admin .message-content {
      background: var(--panel2);
      border: 1px solid var(--border);
      color: var(--ink);
    }
    
    .message-time {
      font-size: 11px;
      color: var(--muted);
      margin-top: 4px;
      text-align: right;
    }
    
    .message.admin .message-time {
      text-align: left;
    }
    
    .messaging-input-container {
      display: flex;
      padding: 20px;
      border-top: 1px solid var(--border);
      gap: 12px;
      background: var(--panel);
    }
    
    .messaging-input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--panel2);
      color: var(--ink);
      outline: none;
      font-size: 14px;
      resize: none;
      min-height: 44px;
      max-height: 120px;
    }
    
    .messaging-input:focus {
      border-color: var(--accent1);
      box-shadow: 0 0 0 2px rgba(125, 178, 255, 0.2);
    }
    
    .send-btn {
      padding: 12px 20px;
      background: linear-gradient(135deg, #7db2ff, #7cf2e6);
      color: #0b0f1a;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
      white-space: nowrap;
    }
    
    .send-btn:hover {
      transform: translateY(-1px);
    }
    
    .send-btn:active {
      transform: translateY(0);
    }
    
    .send-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Welcome Section */
    .welcome-section {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .welcome-title {
      font-size: 24px;
      font-weight: 600;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    
    .welcome-subtitle {
      color: var(--muted);
      margin-bottom: 16px;
    }
    
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    
    .quick-action {
      padding: 12px;
      background: var(--panel2);
      border: 1px solid var(--border);
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: left;
    }
    
    .quick-action:hover {
      background: rgba(125, 178, 255, 0.1);
      border-color: rgba(125, 178, 255, 0.3);
    }
    
    .quick-action-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .quick-action-desc {
      font-size: 13px;
      color: var(--muted);
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .messaging-container {
        height: calc(100vh - 160px);
      }
      
      .messaging-input-container {
        padding: 16px;
      }
      
      .message-content {
        max-width: 85%;
      }
      
      .quick-actions {
        grid-template-columns: 1fr;
      }
    }
    
    /* Typing indicator */
    .typing-indicator {
      display: flex;
      align-items: center;
      padding: 8px 16px;
      color: var(--muted);
      font-size: 13px;
      font-style: italic;
    }
    
    .typing-dots {
      display: inline-flex;
      margin-left: 8px;
    }
    
    .typing-dots span {
      width: 4px;
      height: 4px;
      border-radius: 50%;
      background: var(--muted);
      margin: 0 1px;
      animation: typing 1.4s infinite ease-in-out;
    }
    
    .typing-dots span:nth-child(1) { animation-delay: -0.32s; }
    .typing-dots span:nth-child(2) { animation-delay: -0.16s; }
    
    @keyframes typing {
      0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Header -->
    <header>
      <div class="brand">
        <a href="index.html">
          <img src="images/logo.png" alt="CustomPC.tech logo"
            style="height:100px;width:100px;display:inline-block;vertical-align:middle;object-fit:contain;border-radius:50%;" />
          <span style="margin-left:8px;vertical-align:middle;">CustomPC.tech</span>
        </a>
      </div>
      <nav>
        <a class="pill" href="builds.html">Builds</a>
        <a class="pill" href="index.html">Custom PC</a>
        <a class="pill" href="about.html">About</a>
        <a class="pill" href="contact.html">Contact</a>
        <a class="pill active" href="messaging.html">Live Chat</a>
      </nav>
    </header>

    <!-- Welcome Section -->
    <section class="welcome-section">
      <div class="welcome-title">
        <div class="live-indicator"></div>
        Live Messaging
      </div>
      <p class="welcome-subtitle">Chat with our PC experts in real-time for instant help and support</p>
      
      <div class="quick-actions">
        <div class="quick-action" onclick="startQuickChat('support')">
          <div class="quick-action-title">🛠️ Technical Support</div>
          <div class="quick-action-desc">Get help with PC issues or questions</div>
        </div>
        
        <div class="quick-action" onclick="startQuickChat('quote')">
          <div class="quick-action-title">💰 Get a Quote</div>
          <div class="quick-action-desc">Pricing for custom build projects</div>
        </div>
        
        <div class="quick-action" onclick="startQuickChat('general')">
          <div class="quick-action-title">❓ General Question</div>
          <div class="quick-action-desc">Other inquiries and information</div>
        </div>
      </div>
    </section>

    <!-- Main Messaging Interface -->
    <div class="messaging-container">
      <div class="messaging-header">
        <div class="messaging-title">
          <div class="live-indicator"></div>
          Live Chat Support
        </div>
        <div style="font-size: 14px; color: var(--muted);">
          <span id="connection-status">Connecting...</span>
        </div>
      </div>
      
      <div class="messaging-status">
        <div class="status-indicator"></div>
        <span id="status-text">Notifying our team to join the chat...</span>
      </div>
      
      <div class="messaging-chat" id="messaging-chat">
        <div class="message system">
          <div class="message-content">
            Welcome to CustomPC.tech live support! 🎮<br><br>
            We're notifying our team to join the chat. Please describe what you need help with and we'll be with you shortly.
          </div>
        </div>
      </div>
      
      <div class="messaging-input-container">
        <textarea 
          id="messaging-input" 
          class="messaging-input" 
          placeholder="Type your message here..."
          rows="1"
        ></textarea>
        <button id="send-btn" class="send-btn" onclick="sendMessage()">Send</button>
      </div>
    </div>
  </div>

  <script src="shared-auth.js"></script>
  
  <script>
    class LiveMessagingPage {
      constructor() {
        this.messageQueue = [];
        this.isTyping = false;
        this.init();
      }
      
      init() {
        this.setupInputHandlers();
        this.notifyAdmin();
        this.updateConnectionStatus();
        this.autoResizeTextarea();
      }
      
      setupInputHandlers() {
        const input = document.getElementById('messaging-input');
        const sendBtn = document.getElementById('send-btn');
        
        if (input) {
          // Enter to send (Shift+Enter for new line)
          input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              sendMessage();
            }
          });
          
          // Auto-resize textarea
          input.addEventListener('input', () => {
            this.autoResizeTextarea();
          });
          
          // Focus input on page load
          setTimeout(() => input.focus(), 500);
        }
      }
      
      autoResizeTextarea() {
        const input = document.getElementById('messaging-input');
        if (input) {
          input.style.height = 'auto';
          input.style.height = Math.min(input.scrollHeight, 120) + 'px';
        }
      }
      
      async notifyAdmin() {
        try {
          // Get user info
          const sharedAuth = window.sharedAuth;
          const currentUser = sharedAuth ? sharedAuth.getCurrentUser() : null;
          const userName = currentUser && currentUser.username !== 'Anonymous' ? currentUser.username : 'Anonymous User';
          const userEmail = currentUser && currentUser.email ? currentUser.email : 'No email provided';
          
          // Send notification email
          const formData = new FormData();
          formData.append('_replyto', 'griffin@crowhurst.ws');
          formData.append('name', 'CustomPC Live Chat System');
          formData.append('message', `🚨 LIVE CHAT REQUEST 🚨

User: ${userName}
Email: ${userEmail}
Time: ${new Date().toLocaleString()}
Page: ${window.location.href}

A user has opened the live chat and is waiting for assistance. Please log into the CustomPC admin panel to respond.

This is an automated notification from the CustomPC.tech live messaging system.`);
          
          await fetch('https://formspree.io/f/xrblokly', {
            method: 'POST',
            headers: { 'Accept': 'application/json' },
            body: formData
          });
          
          console.log('Admin notification sent successfully');
          
          // Update status
          setTimeout(() => {
            this.updateStatus('Admin notified - joining chat soon...');
          }, 2000);
          
        } catch (error) {
          console.error('Failed to notify admin:', error);
          this.updateStatus('Connection established - ready to chat');
        }
      }
      
      updateConnectionStatus() {
        const statusEl = document.getElementById('connection-status');
        if (statusEl) {
          statusEl.textContent = 'Connected';
          statusEl.style.color = '#00ff88';
        }
      }
      
      updateStatus(message) {
        const statusEl = document.getElementById('status-text');
        if (statusEl) {
          statusEl.textContent = message;
        }
      }
      
      addMessage(content, type = 'user', showTime = true) {
        const chat = document.getElementById('messaging-chat');
        if (!chat) return;
        
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}`;
        
        const time = showTime ? `<div class="message-time">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>` : '';
        
        messageDiv.innerHTML = `
          <div class="message-content">${content}${time}</div>
        `;
        
        chat.appendChild(messageDiv);
        chat.scrollTop = chat.scrollHeight;
        
        // Add smooth scroll animation
        messageDiv.style.opacity = '0';
        messageDiv.style.transform = 'translateY(20px)';
        setTimeout(() => {
          messageDiv.style.transition = 'all 0.3s ease';
          messageDiv.style.opacity = '1';
          messageDiv.style.transform = 'translateY(0)';
        }, 10);
      }
      
      showTypingIndicator() {
        if (this.isTyping) return;
        
        const chat = document.getElementById('messaging-chat');
        if (!chat) return;
        
        const typingDiv = document.createElement('div');
        typingDiv.className = 'typing-indicator';
        typingDiv.id = 'typing-indicator';
        typingDiv.innerHTML = `
          Admin is typing
          <div class="typing-dots">
            <span></span>
            <span></span>
            <span></span>
          </div>
        `;
        
        chat.appendChild(typingDiv);
        chat.scrollTop = chat.scrollHeight;
        this.isTyping = true;
      }
      
      hideTypingIndicator() {
        const typingIndicator = document.getElementById('typing-indicator');
        if (typingIndicator) {
          typingIndicator.remove();
          this.isTyping = false;
        }
      }
    }
    
    // Global functions
    function sendMessage() {
      const input = document.getElementById('messaging-input');
      const sendBtn = document.getElementById('send-btn');
      
      if (!input || !input.value.trim()) return;
      
      const message = input.value.trim();
      input.value = '';
      
      // Reset textarea height
      input.style.height = 'auto';
      
      // Disable send button temporarily
      sendBtn.disabled = true;
      setTimeout(() => sendBtn.disabled = false, 1000);
      
      // Add user message
      if (window.liveMessaging) {
        window.liveMessaging.addMessage(message, 'user');
        
        // Simulate admin response
        setTimeout(() => {
          window.liveMessaging.showTypingIndicator();
        }, 1000);
        
        setTimeout(() => {
          window.liveMessaging.hideTypingIndicator();
          window.liveMessaging.addMessage(
            "Thanks for your message! An admin will respond shortly. You can also email us directly at griffin@crowhurst.ws for immediate assistance.",
            'system',
            false
          );
        }, 3000);
      }
      
      // Focus back to input
      input.focus();
    }
    
    function startQuickChat(type) {
      const templates = {
        support: "Hi! I need technical support with my PC. Here's what's happening: [Please describe your issue]",
        quote: "Hi! I'd like to get a quote for a custom PC build. My requirements are: [Please describe what you need]",
        general: "Hi! I have a question about: [Please describe your question]"
      };
      
      const input = document.getElementById('messaging-input');
      if (input && templates[type]) {
        input.value = templates[type];
        input.focus();
        
        // Position cursor at the placeholder
        const placeholderStart = input.value.indexOf('[');
        if (placeholderStart !== -1) {
          input.setSelectionRange(placeholderStart, input.value.indexOf(']') + 1);
        }
        
        // Auto-resize
        if (window.liveMessaging) {
          window.liveMessaging.autoResizeTextarea();
        }
      }
    }
    
    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      window.liveMessaging = new LiveMessagingPage();
    });
  </script>
</body>
</html>
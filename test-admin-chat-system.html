<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Chat System Test</title>
  <style>
    :root{
      --space:10px; --space-sm:6px; --space-lg:16px;
      --bg:#0a0f1a; --ink:#e9eefc; --muted:#aeb9d4;
      --panel:#111729; --panel2:#0d1426; --border:rgba(255,255,255,.08);
      --accent1:#7db2ff; --accent2:#7cf2e6;
      --radius:18px; --shadow:0 20px 40px rgba(0,0,0,.35);
      --max:1200px;
    }
    body {
      font-family: system-ui;
      margin: 0;
      padding: 20px;
      background: radial-gradient(1200px 600px at 50% -10%, #0f162b 8%, transparent 55%), linear-gradient(#081021, #0a0f1a 40%, #0a0f1a);
      color: var(--ink);
      min-height: 100vh;
    }
    .test-container {
      max-width: 1000px;
      margin: 0 auto;
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 30px;
      box-shadow: var(--shadow);
    }
    .test-section {
      margin: 20px 0;
      padding: 20px;
      background: var(--panel2);
      border: 1px solid var(--border);
      border-radius: 12px;
    }
    .btn {
      display: inline-block;
      padding: 12px 20px;
      background: linear-gradient(90deg, var(--accent1), var(--accent2));
      color: #0b0f1a;
      border: none;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
      margin: 8px;
      transition: transform 0.2s;
    }
    .btn:hover {
      transform: translateY(-2px);
    }
    .btn-secondary {
      background: var(--panel);
      color: var(--ink);
      border: 1px solid var(--border);
    }
    .status {
      padding: 12px;
      border-radius: 8px;
      margin: 10px 0;
    }
    .success { background: rgba(124,242,230,.12); border: 1px solid rgba(124,242,230,.35); }
    .info { background: rgba(125,178,255,.12); border: 1px solid rgba(125,178,255,.35); }
    .warning { background: rgba(255,193,7,.12); border: 1px solid rgba(255,193,7,.35); }
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }
    .feature-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }
    .feature-icon {
      width: 60px;
      height: 60px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 16px;
      font-size: 24px;
      background: linear-gradient(135deg, #7cf2e6, #7db2ff);
    }
    .demo-layout {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }
    .demo-panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      min-height: 200px;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>🔧 Admin Chat Management System</h1>
    <p style="color: var(--muted);">Complete admin interface for managing customer conversations in real-time.</p>
    
    <div class="test-section">
      <h2>✅ Admin Chat System Features</h2>
      <div class="status success">
        <strong>🎉 Implementation Complete!</strong> Admins now have a dedicated sidebar showing all active customer chats with the ability to click and respond to each conversation.
      </div>
      
      <div class="feature-grid">
        <div class="feature-card">
          <div class="feature-icon">💬</div>
          <h3>Active Chat List</h3>
          <p style="color: var(--muted); font-size: 14px;">See all ongoing conversations in sidebar</p>
        </div>
        
        <div class="feature-card">
          <div class="feature-icon">👤</div>
          <h3>Customer Names</h3>
          <p style="color: var(--muted); font-size: 14px;">Each chat shows customer name and avatar</p>
        </div>
        
        <div class="feature-card">
          <div class="feature-icon">🔔</div>
          <h3>Unread Indicators</h3>
          <p style="color: var(--muted); font-size: 14px;">Red badges show unread message counts</p>
        </div>
        
        <div class="feature-card">
          <div class="feature-icon">⚡</div>
          <h3>Real-time Updates</h3>
          <p style="color: var(--muted); font-size: 14px;">Chat list refreshes automatically</p>
        </div>
      </div>
    </div>

    <div class="test-section">
      <h2>🎨 Admin Interface Layout</h2>
      <div class="demo-layout">
        <div class="demo-panel">
          <h4>Admin Sidebar (Left)</h4>
          <ul style="font-size: 14px; line-height: 1.6;">
            <li><strong>Active Chats</strong> - Header with chat count</li>
            <li><strong>Chat List</strong> - Scrollable list of conversations</li>
            <li><strong>Customer Avatars</strong> - Initials in colored circles</li>
            <li><strong>Message Preview</strong> - Last message snippet</li>
            <li><strong>Time Stamps</strong> - When last active</li>
            <li><strong>Unread Badges</strong> - Red notification dots</li>
            <li><strong>Admin Actions</strong> - Refresh, mark all read</li>
          </ul>
        </div>
        
        <div class="demo-panel">
          <h4>Chat Area (Right)</h4>
          <ul style="font-size: 14px; line-height: 1.6;">
            <li><strong>Selected Chat</strong> - Currently active conversation</li>
            <li><strong>Message History</strong> - Full conversation thread</li>
            <li><strong>Customer Info</strong> - Name, email, session details</li>
            <li><strong>Admin Input</strong> - Type and send responses</li>
            <li><strong>Message Types</strong> - User, admin, system messages</li>
            <li><strong>Timestamps</strong> - When each message was sent</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="test-section">
      <h2>🔐 Admin Authentication</h2>
      <div class="status info">
        <strong>Admin Login Required:</strong> The chat management sidebar only appears when logged in as admin.
      </div>
      
      <div class="status warning">
        <strong>Current Admin Credentials:</strong><br>
        Username: <code>Minty-Komodo</code><br>
        Password: <code>hJ.?'0PcU0).1.0.1PCimA4%oU</code><br>
        Email: <code>griffin@crowhurst.ws</code>
      </div>
    </div>

    <div class="test-section">
      <h2>🚀 How to Test Admin Features</h2>
      <ol style="line-height: 1.6;">
        <li><strong>Login as Admin:</strong> Go to <a href="login.html?admin=true" style="color: var(--accent1);">login.html?admin=true</a></li>
        <li><strong>Enter Admin Credentials:</strong> Use the credentials above</li>
        <li><strong>Open Messaging:</strong> Go to <a href="messaging.html" style="color: var(--accent1);">messaging.html</a></li>
        <li><strong>See Admin Sidebar:</strong> Left sidebar shows "Active Chats"</li>
        <li><strong>Test with Regular User:</strong> Open messaging in incognito/private window</li>
        <li><strong>Send Messages:</strong> Send messages as regular user</li>
        <li><strong>See in Admin:</strong> Messages appear in admin chat list</li>
        <li><strong>Click to Respond:</strong> Click chat in sidebar to open conversation</li>
      </ol>
    </div>

    <div class="test-section">
      <h2>💬 Chat Management Features</h2>
      <ul style="line-height: 1.6;">
        <li>✅ <strong>Active Chat List</strong> - Shows all conversations from last 24 hours</li>
        <li>✅ <strong>Customer Identification</strong> - Name, avatar, and email for each chat</li>
        <li>✅ <strong>Message Previews</strong> - See last message in each conversation</li>
        <li>✅ <strong>Unread Indicators</strong> - Red badges show unread message counts</li>
        <li>✅ <strong>Time Stamps</strong> - Shows when each conversation was last active</li>
        <li>✅ <strong>Click to Open</strong> - Click any chat to view full conversation</li>
        <li>✅ <strong>Real-time Updates</strong> - Chat list refreshes every 5 seconds</li>
        <li>✅ <strong>Message History</strong> - Full conversation history preserved</li>
        <li>✅ <strong>Admin Responses</strong> - Send messages as admin to customers</li>
        <li>✅ <strong>Session Tracking</strong> - Track conversation duration and activity</li>
      </ul>
    </div>

    <div class="test-section">
      <h2>🔧 Admin Actions</h2>
      <div class="status info">
        <strong>Available Admin Controls:</strong>
        <ul style="margin: 8px 0 0 20px;">
          <li><strong>Refresh Chats</strong> - Manually refresh the chat list</li>
          <li><strong>Mark All Read</strong> - Clear all unread indicators</li>
          <li><strong>Payment System</strong> - Quick access to payment processing</li>
          <li><strong>Auto-refresh</strong> - Automatic updates every 5 seconds</li>
        </ul>
      </div>
    </div>

    <div class="test-section">
      <h2>📱 User Experience</h2>
      <div class="demo-layout">
        <div class="demo-panel">
          <h4>For Regular Users</h4>
          <ul style="font-size: 14px;">
            <li>Same clean chat interface</li>
            <li>No admin sidebar visible</li>
            <li>Messages saved to chat sessions</li>
            <li>Email notifications sent to admin</li>
            <li>Professional conversation experience</li>
          </ul>
        </div>
        
        <div class="demo-panel">
          <h4>For Admins</h4>
          <ul style="font-size: 14px;">
            <li>Admin sidebar with active chats</li>
            <li>Click any chat to respond</li>
            <li>See all customer conversations</li>
            <li>Unread message indicators</li>
            <li>Full conversation management</li>
          </ul>
        </div>
      </div>
    </div>

    <div class="test-section">
      <h2>🚀 Quick Test Actions</h2>
      <button class="btn" onclick="simulateAdminLogin()">Simulate Admin Login</button>
      <a href="messaging.html" class="btn">Open Messaging Interface</a>
      <a href="login.html?admin=true" class="btn btn-secondary">Admin Login Page</a>
      <button class="btn btn-secondary" onclick="createTestChats()">Create Test Chats</button>
    </div>

    <div id="test-results"></div>
  </div>

  <script src="shared-auth.js"></script>
  
  <script>
    function simulateAdminLogin() {
      const adminUser = {
        username: "Minty-Komodo",
        email: "griffin@crowhurst.ws",
        loginTime: new Date().toISOString()
      };
      
      localStorage.setItem('custompc_user', JSON.stringify(adminUser));
      addResult('Admin Login', true, 'Simulated admin login - now go to messaging.html to see admin sidebar');
      
      // Trigger auth state change
      window.dispatchEvent(new CustomEvent('authStateChanged'));
    }
    
    function createTestChats() {
      const testChats = [
        {
          id: 'chat_test_1',
          userName: 'John Doe',
          userEmail: 'john@example.com',
          startTime: new Date(Date.now() - 300000).toISOString(), // 5 minutes ago
          lastActivity: new Date(Date.now() - 60000).toISOString(), // 1 minute ago
          messages: [
            {
              content: 'Hi, I need help with a gaming PC build',
              type: 'user',
              timestamp: new Date(Date.now() - 300000).toISOString()
            },
            {
              content: 'My budget is around $2000',
              type: 'user',
              timestamp: new Date(Date.now() - 60000).toISOString()
            }
          ],
          unreadCount: 2,
          status: 'active'
        },
        {
          id: 'chat_test_2',
          userName: 'Sarah Wilson',
          userEmail: 'sarah@example.com',
          startTime: new Date(Date.now() - 900000).toISOString(), // 15 minutes ago
          lastActivity: new Date(Date.now() - 300000).toISOString(), // 5 minutes ago
          messages: [
            {
              content: 'I need a workstation for video editing',
              type: 'user',
              timestamp: new Date(Date.now() - 900000).toISOString()
            }
          ],
          unreadCount: 1,
          status: 'active'
        },
        {
          id: 'chat_test_3',
          userName: 'Mike Johnson',
          userEmail: 'mike@example.com',
          startTime: new Date(Date.now() - 1800000).toISOString(), // 30 minutes ago
          lastActivity: new Date(Date.now() - 600000).toISOString(), // 10 minutes ago
          messages: [
            {
              content: 'What are your payment options?',
              type: 'user',
              timestamp: new Date(Date.now() - 1800000).toISOString()
            },
            {
              content: 'We accept all major credit cards through Square',
              type: 'admin',
              timestamp: new Date(Date.now() - 600000).toISOString()
            }
          ],
          unreadCount: 0,
          status: 'active'
        }
      ];
      
      localStorage.setItem('custompc_chat_sessions', JSON.stringify(testChats));
      addResult('Test Chats', true, 'Created 3 test chat sessions - login as admin and go to messaging.html to see them');
    }
    
    function addResult(name, success, message) {
      const results = document.getElementById('test-results');
      const div = document.createElement('div');
      div.className = `status ${success ? 'success' : 'error'}`;
      div.innerHTML = `<strong>${name}:</strong> ${message}`;
      results.appendChild(div);
      
      // Auto-remove after 8 seconds
      setTimeout(() => {
        if (div.parentNode) {
          div.style.opacity = '0';
          div.style.transition = 'opacity 0.3s';
          setTimeout(() => {
            if (div.parentNode) {
              div.parentNode.removeChild(div);
            }
          }, 300);
        }
      }, 8000);
    }
    
    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        addResult('System Check', true, 'Admin chat management system loaded successfully');
      }, 500);
    });
  </script>
</body>
</html>